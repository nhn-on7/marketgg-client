<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>상품 상세</title>
    </head>
    <body>
        <table>
            <thead>
                <tr>
                    <th>찜</th>
                    <th>상품 번호</th>
                    <th>카테고리</th>
                    <th>자원</th>
                    <th>상품 이름</th>
                    <th>상품 내용</th>
                    <th>재고량</th>
                    <th>가격</th>
                    <th>상품 설명</th>
                    <th>상품 단위</th>
                    <th>배송 타입</th>
                    <th>원산지</th>
                    <th>포장 종류</th>
                    <th>유효기간</th>
                    <th>알러지 정보</th>
                    <th>용량</th>
                    <th>생성 일시</th>
                    <th>수정 일시</th>
                    <th>삭제 일시</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="product : ${productDetails}">
                    <td>
                        <script type="text/javascript">
                            $(document).ready(function(){
                                dibView();
                            });
                            let memberId = '${memberId}';
                            let productId = '${product.productNo}';

                            function dibView() {
                                $.ajax({
                                    url: 'localhost:5050/dibs',
                                    type: 'post',
                                    async: true,
                                    data: {
                                        'memberId': memberId,
                                        'productId': productId
                                    },
                                    dataType: "json",
                                    success: function (data) {
                                        let htmlBody = '';
                                        if (data.exist === 1) {
                                            htmlBody += '<a onclick="dibDelete(' + memberId + '' + productId + ');"'
                                                + '>찜제거</a>'
                                        } else {
                                            htmlBody += '<a onclick="dibInsert(' + memberId + '' + productId + ');"'
                                                + '>찜</a>'
                                        }
                                        $('#dib').html(htmlBody);
                                    }
                                })
                            }
                            function dibInsert(memberId, productId) {
                                $.ajax({
                                    url: '/dibs/insert' + memberId + '/' + productId,
                                    type: 'get',
                                    success: function (data) {
                                        if (data === 1)
                                            dibView();
                                    }
                                });
                            }
                            function dibDelete(memberId, productId) {
                                $.ajax({
                                    url: '/dibs/delete' + memberId + '/' + productId,
                                    type: 'get',
                                    success: function (data) {
                                        if (data === 1)
                                            dibView();
                                    }
                                });
                            }
                        </script>
                        <div th:id="dib"></div>
                    </td>
                    <td th:text="${product.productNo}"></td>
                    <td th:text="${product.categoryCode}"></td>
                    <td th:text="${product.assetNo}"></td>
                    <td th:text="${product.name}"></td>
                    <td th:text="${product.name}"></td>
                    <td th:text="${product.content}"></td>
                    <td th:text="${product.totalStock}"></td>
                    <td th:text="${product.price}"></td>
                    <td th:text="${product.description}"></td>
                    <td th:text="${product.unit}"></td>
                    <td th:text="${product.deliveryType}"></td>
                    <td th:text="${product.origin}"></td>
                    <td th:text="${product.packageType}"></td>
                    <td th:text="${product.expirationDate}"></td>
                    <td th:text="${product.allergyInfo}"></td>
                    <td th:text="${product.capacity}"></td>
                    <td th:text="${product.createdAt}"></td>
                    <td th:text="${product.updatedAt}"></td>
                    <td th:text="${product.deletedAt}"></td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
